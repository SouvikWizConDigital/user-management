databaseChangeLog:
  - changeSet:
      id: 004-soft-delete-users
      author: souvik
      changes:

        # soft delete columns
        - addColumn:
            tableName: users
            columns:
              - column:
                  name: deleted
                  type: boolean
                  defaultValueBoolean: false
                  constraints:
                    nullable: false

              - column:
                  name: deleted_at
                  type: timestamp
                  constraints:
                    nullable: true

        # existing NULL values (DATA MIGRATION)
        - update:
            tableName: users
            columns:
              - column:
                  name: name
                  value: "UNKNOWN"
            where: name IS NULL

        - update:
            tableName: users
            columns:
              - column:
                  name: phone_number
                  value: "0000000000"
            where: phone_number IS NULL

        # Enforce NOT NULL constraints (SCHEMA MIGRATION)
        - addNotNullConstraint:
            tableName: users
            columnName: name
            columnDataType: varchar(255)

        - addNotNullConstraint:
            tableName: users
            columnName: phone_number
            columnDataType: varchar(10)
